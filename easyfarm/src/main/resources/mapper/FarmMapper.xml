<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="easyfarm.dao.FarmMapper">
	<resultMap type="Farm" id="farmResultMap">
		<id property="farmCode" column="farm_code" />
		<result property="farmName" column="farm_name"/>
		<result property="ceoId" column="ceo_member_id"/>
		<result property="farmMemberLevel" column="farm_level_code"/>
		<result property="farmArea" column="farm_area"/>
		<result property="farmAddress" column="farm_address"/>
		<result property="farmPublicStatus" column="farm_public_status"/>
		<result property="farmRegDate" column="farm_reg_date"/>
	</resultMap>

	<resultMap type="FarmMember" id="farmMemberResultMap">
		<id property="farmMemberCode" column="farm_member_code" />
		<result property="farmCode" column="farm_code"/>
		<result property="farmMemberId" column="farm_member_id"/>
		<result property="farmLevelCode" column="farm_level_code"/>
		<result property="farmLevelName" column="farm_level_name"/>
		<result property="farmJoinApprovalDate" column="farm_join_approval_date"/>
		<result property="farmMemberStatus" column="farm_member_status"/>
	</resultMap>
	
	
	<select id="farmByName" resultMap="farmResultMap" parameterType="String" >
		SELECT 
			farm_code, 
			farm_name, 
			ceo_member_id, 
			farm_area, 
			farm_address, 
			farm_public_status, 
			farm_reg_date
		FROM 
			tb_farm
		WHERE
			farm_name = #{farmName}
	</select>
	
	<insert id="addFarm" parameterType="Farm">
		INSERT INTO tb_farm
			( 
			farm_name, 
			ceo_member_id, 
			farm_area, 
			farm_address, 
			farm_public_status, 
			farm_reg_date)
		VALUES 
			( 
			#{farmName}, 
			#{ceoId}, 
			#{farmArea}, 
			#{farmAddress}, 
			#{farmPublicStatus}, 
			NOW())
	</insert>
	
	<insert id="addFarmMember" parameterType="FarmMember">
		INSERT INTO tb_farm_member
			( 
			farm_code, 
			farm_member_id, 
			farm_level_code, 
			farm_join_approval_date, 
			farm_member_status)
		VALUES 
			( 
			sf_addmember_farm_code(#{farmCode}), 
			#{farmMemberId}, 
			#{farmLevelCode}, 
			NOW(), 
			#{farmMemberStatus})
	</insert>
	
	
	<select id="myFamr" resultMap="farmResultMap" parameterType="String">
		 SELECT 
			f.farm_code, 
			f.farm_name, 
			f.ceo_member_id,
			fm.farm_level_code, 
			f.farm_area, 
			f.farm_address, 
			f.farm_public_status, 
			f.farm_reg_date
		FROM 
			tb_farm f
			join
			tb_farm_member fm
		WHERE
			f.ceo_member_id =#{memberId}
		GROUP BY f.farm_code;
	</select>
	
	<select id="detailFarm" resultMap="farmResultMap" parameterType="Farm">
		SELECT 
			f.farm_code, 
			f.farm_name, 
			f.ceo_member_id,
			fm.farm_level_code, 
			f.farm_area, 
			f.farm_address, 
			f.farm_public_status, 
			f.farm_reg_date
		FROM 
			tb_farm f
			join
			tb_farm_member fm
			on
			f.farm_code = fm.farm_code
		WHERE
			fm.farm_member_id =#{ceoId}
			AND
			f.farm_code = #{farmCode}
			AND
			fm.farm_member_status ='정상'
		GROUP BY f.farm_code;
	</select>
	
	
	<select id="belongFarm" resultMap="farmResultMap" parameterType="String">
		SELECT 
			f.farm_code, 
			f.farm_name, 
			f.ceo_member_id,
			fm.farm_level_code, 
			f.farm_area, 
			f.farm_address, 
			f.farm_public_status, 
			f.farm_reg_date
		FROM 
			tb_farm_member as fm
			join
			tb_farm_member_level AS l
			join
			tb_farm as f
			on
			fm.farm_code = f.farm_code
			AND
			fm.farm_member_id != f.ceo_member_id
		WHERE
			fm.farm_member_id = #{memberId}
			AND
			fm.farm_member_status ='정상'
		GROUP BY f.farm_code

	
	</select>
</mapper>