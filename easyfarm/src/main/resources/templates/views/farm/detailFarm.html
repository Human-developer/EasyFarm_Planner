<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">

	<th:block layout:fragment="customTitle">
		<title>농가상세보기</title>
	</th:block>
	
	<th:block layout:fragment="pageTitle">
		<a th:href="@{/farm}">농가관리</a>>농가상세보기
	</th:block>
	
	<th:block layout:fragment="customCss">
		<style type="text/css">
			.modal {
			        text-align: center;
			}
			
			.modal:before {
			                display: inline-block;
			                vertical-align: middle;
			                content: " ";
			                height: 100%;
			}
			
			 
			.modal-dialog {
			        display: inline-block;
			        text-align: left;
			        vertical-align: middle;
			}
		</style>
	</th:block>
	
	<th:block layout:fragment="customJavaScript">
		<script type="text/javascript">		
			$('.farmCancelBtn').click(function(){
				$('#cancelRequestReason').val('');
				
				//모달에 데이터 출력해줄 태그들
				var modalFarmName = $('#modalFarmName');
				var modalFarmAddress = $('#modalFarmAddress');
				var modalFarmArea = $('#modalFarmArea');
				var modalCeoId = $('#modalCeoId');
				
				modalFarmName.text("[[${farm.farmName}]]");
				modalFarmAddress.text("[[${farm.farmAddress}]]");
				modalFarmArea.text("[[${farm.farmArea}]]");
				modalCeoId.text("[[${farm.ceoId}]]");
			});
			
			
			$('#addCancelMember').click(function(){
				var farmJoinPurpose = $('#cancelRequestReason').val();
				var modalFarmName = $('#modalFarmName').text();
				
				 var request = $.ajax({
		               url:"/farm/addLeaverFarm",
		               method:"post", 
		               data :	{
									"farmName":modalFarmName,
									"cancelRequestReason":farmJoinPurpose
								},
		            });
		            request.done(function(data){
		            	var checkType = 'error';
		            	if(data =='신청완료'){
		            		checkType = 'success';
		            	}
		            	
		            	
		            	swal({
							title: "농가 탈퇴 신청",
							text: data,
							type: checkType,
							confirmButtonColor: '#304ffe'
						});
		            });
		            request.fail(function( jqXHR, textStatus ){
		               alert( "Request failed : " + textStatus );
		            });
				
			});
		</script>
	</th:block>
	
	
	<th:block layout:fragment="customContents">
		<div class ="container-fluid">
			<div class ="row">
			
				<div class ="col-sm-8 col-sm-offset-2">
					<div class ="box-content">
						<div class ="row">
							<div class ="col-sm-6">
								<h3>농가 상세보기</h3>
							</div>
							<div class ="col-sm-6" style ="text-align: right;">
								<button th:if = "${farm.farmMemberLevel == 'farm_level_1'}"  class="btn btn-xs btn-danger margin-top-20" th:href="@{#}">농가삭제</button>
								<button th:if = "${farm.farmMemberLevel != 'farm_level_1'}" class ="farmCancelBtn btn btn-xs btn-danger margin-top-20" data-toggle="modal" data-target="#farmCancelModal">농가탈퇴</button>
							</div>
						</div>
						<hr class ="col-sm-12" style ="margin: 0; padding: 0;">
							<table class ="table">
								<tbody>
									<tr>
										<th>농가명</th>
										<td th:text = "${farm.farmName}"/>
									</tr>
									<tr>
										<th>대표아이디</th>
										<td th:text = "${farm.ceoId}"/>
									</tr>
									<tr>
										<th>토지면적</th>
										<td th:text = "${farm.farmArea}"/>
									</tr>
									<tr>
										<th>주소</th>
										<td th:text = "${farm.farmAddress}"/>
									</tr>
									<tr>
										<th>생성일</th>
										<td th:text = "${farm.farmRegDate}"/>
									</tr>
									<tr>
										<th>공개유무</th>
										<td th:if = "${farm.farmPublicStatus == 'Y'}">공개</td>
										<td th:if = "${farm.farmPublicStatus == 'N'}">비공개</td>
									</tr>
								</tbody>
								
							
							</table>
							<div class ="t-center">
								<a th:if = "${farm.farmMemberLevel == 'farm_level_1' OR farm.farmMemberLevel == 'farm_level_2'}"  class="btn btn-xs btn-primary" th:href="@{/farm/modifyFarm(farmCode=${farm.farmCode},farmMemberLevel=${farm.farmMemberLevel})}">농가수정</a>
								<a class="btn btn-xs btn-primary" th:href="@{/farm/getMemberFarm(farmCode=${farm.farmCode},farmMemberLevel=${farm.farmMemberLevel})}">회원조회</a>
								<a th:if = "${farm.farmMemberLevel == 'farm_level_1' OR farm.farmMemberLevel == 'farm_level_2'}" class="btn btn-xs btn-primary" th:href="@{/farm/getJoinFarm(farmCode=${farm.farmCode})}">가입신청리스트</a>
								<a th:if = "${farm.farmMemberLevel == 'farm_level_1' OR farm.farmMemberLevel == 'farm_level_2'}" class="btn btn-xs btn-primary" th:href="@{/farm/getLeaverFarm(farmCode=${farm.farmCode})}">탈퇴신청리스트</a>
							</div>
							
					</div><!-- end box-content -->
				</div><!-- end col-sm-8 col-sm-offset-2 -->
			</div><!-- end row-->
		</div> <!-- end container-->
	</th:block>
	
	<!-- customModals start -->
	<th:block layout:fragment="customModals">
		<div class="modal fade" id="farmCancelModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title t-center" id="myModalLabel">농가 탈퇴 신청</h4>
					</div>
					<div class="modal-body">
						<div class ="row">
							<div class ="col-xs-12">
								<div class ="col-xs-12 margin-bottom-15" style ="padding: 0px;">
									<strong class ="col-xs-3 col-xs-offset-2">농가 이름 : </strong>
									<div id="modalFarmName"></div>
								</div>
								<div class ="col-xs-12 margin-bottom-15" style ="padding: 0px;">
									<strong class ="col-xs-3 col-xs-offset-2">대표 아이디 : </strong>
									<div id="modalCeoId"></div>
								</div>
								<div class ="col-xs-12 margin-bottom-15" style ="padding: 0px;">
									<strong class ="col-xs-3 col-xs-offset-2">농가 주소 : </strong>
									<div id="modalFarmAddress"></div>
								</div>
								<div class ="col-xs-12 margin-bottom-15" style ="padding: 0px;">
									<strong class ="col-xs-3 col-xs-offset-2">토지면적 : </strong>
									<div id="modalFarmArea"></div>
								</div>
							</div>	
							<div class ="col-xs-12">
								<h3 class ="t-center">탈퇴사유</h3>
								<textarea id = "cancelRequestReason" style ="resize: none; margin-bottom: 15px"class ="form-control" cols="10"></textarea>
							</div>
						</div>
						
					</div>
					<div class="modal-footer t-center">
						<button type="button" class="btn btn-default btn-sm waves-effect waves-light" data-dismiss="modal">취소</button>
						<button type="button" id ="addCancelMember" class="btn btn-primary btn-sm waves-effect waves-light" data-dismiss="modal">탈퇴 신청</button>
					</div>
				</div>
			</div>
		</div>
	</th:block>
	<!-- customModals end -->

</html>