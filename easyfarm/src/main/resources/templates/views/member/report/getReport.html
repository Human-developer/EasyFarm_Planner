<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">
	  
	<!-- 화면 title 설정 -->
	<th:block layout:fragment="customTitle">
		<title>신고목록 조회</title>
	</th:block>
	
	<!-- 위에 네비 메뉴에 표시되는 경로 타이틀 -->
	<th:block layout:fragment="pageTitle">
		신고목록 조회
	</th:block>
    <!-- 사용자 정의 css 라이브러리 -->
	<th:block layout:fragment="customCssLib">
		<link rel="stylesheet" th:href="@{/assets/sys/sysStyle.css}">
	</th:block>
	
	<!-- 컨텐츠 작성은 여기서  ↓ ↓ ↓ -->
	<th:block layout:fragment="customContents">
	
	
		
	
				
			<div class="box-content">
	
					<table id="reportTable" >
						<thead>
							<tr>
								<th>신고 코드</th>
								<th>신고사유</th>
								<th>대상 아이디</th>
								<th>작성자 아이디</th>
								<th>내용</th>			
								<th>등록일</th>																						
								<th>상태</th>																						
								<th th:if = "${session.SLEVEL == '관리자'}">승인&반려</th>
								
							</tr>
						</thead>
						<tbody>
							<tr  th:each="r : ${reportList}" th:if = "${r.useStatus != 'N'}">
								<td th:text="${r.reportHistoryCode}"></td>							
								<td th:text="${r.reportReason}"></td>		
								<td th:text="${r.reportedMemberId}"></td>				
								<td th:text="${r.reportMemberId}"></td>			
											
								
								<td ><a th:text="내용" th:data-val="${r.reportDetailReason}" href="#" class="contents"></a></td>								
								<td th:text="${r.reportDate}"></td>
								<td th:if = "${session.SLEVEL == '관리자' && r.reportApproval == '진행중'}" th:text="진행중"></td>
								<td th:if = "${session.SLEVEL == '관리자' && r.reportApproval != '진행중'}" th:text="완료"></td>
																	
								<td th:if = "${session.SLEVEL == '관리자' && r.reportApproval == '진행중'}">
									<div class="btn-group" >
										<button type="button" class="btn btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ><span class="fa fa-balance-scale" ></span></button> 
										<ul class="dropdown-menu">
											<li ><a class="okey" th:data-val="${r.reportHistoryCode}" th:data-val2="승인" th:data-val3="${r.reportedMemberId}" th:data-val4="${r.reportCode}" href="#">승인</a></li>
											<li ><a class="no" th:data-val="${r.reportHistoryCode}" th:data-val2="반려"   href="#">반려</a></li>
										
										</ul> 
									</div>
								</td>
								 <td th:if = "${session.SLEVEL == '관리자' && r.reportApproval != '진행중'}">
									<div class="btn-group" >
										<button type="button" class="btn btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ><span class="fa fa-balance-scale" ></span></button> 
										<ul class="dropdown-menu">
										  	<li th:if="${session.SLEVEL == '관리자'}"><a class="remove" th:data-val="${r.reportHistoryCode}" href="#">삭제</a></li>
										</ul> 
									</div>
								</td> 
								
							</tr>
							
						</tbody>		
	
					</table>
				<div class="modal-content"  style = "display: none">
					<div class="modal-header">
						<button type="button" class="close" ><span class="close" style="color: black;">X</span></button>
						<h4 class="modal-title">신고내용</h4>
					</div>
					<div class="modal-body">
						<p class="text" style="color: black;"></p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn  close" ><span style="color: black;">Close</span> </button>
					</div>
				</div>
		</div>
			
	
	
	</th:block>
	
	
	<th:block layout:fragment="customScriptLib">
		
		<div th:replace="fragments/dataTable :: dataTable" th:remove="tag"></div>	
	</th:block>

	
	<th:block layout:fragment="customJavaScript">
		<script>
		
		var lang_kor = {
		        "decimal" : "",
		        "emptyTable" : "신고자가 없습니다",
		        "info" : "_START_ - _END_ (총 _TOTAL_ 명)",
		        "infoEmpty" : "0명",
		        "infoFiltered" : "(전체 _MAX_ 신고목록 중 검색결과)",
		        "infoPostFix" : "",
		        "thousands" : ",",
		        "lengthMenu" : "_MENU_ 개씩 보기",
		        "loadingRecords" : "로딩중...",
		        "processing" : "처리중...",
		        "search" : "검색 : ",
		        "zeroRecords" : "검색된 목록이 없습니다.",
		        "paginate" : {
		            "first" : "첫 페이지",
		            "last" : "마지막 페이지",
		            "next" : "다음",
		            "previous" : "이전"
		        },
		        "aria" : {
		            "sortAscending" : " :  오름차순 정렬",
		            "sortDescending" : " :  내림차순 정렬"
		        }
		}
		
		$('#reportTable').sysDataTable(lang_kor,[0]);
		
		 $('.contents').click(function(){
			  
	    	  var contents = $(this).attr("data-val");
			  $('.modal-content').attr('style','display: block');
			  $('.text').text(contents);
				   
		  })
		 
		 	
		 $('.close').click(function(){
		  		  
		 	 $('.modal-content').attr('style','display: none');
		 })
		 
		 $('.remove').click(function(){
			 var result = $(this).attr("data-val");
			 location.href = "/member/removeReportHistoryCode?reportHistoryCode="+result;
		 })
		 
		
		 
		 
		$('.okey').click(function(){	
			 var removeCode = $(this).attr("data-val");
		  	 var result = $(this).attr("data-val2");
		  	 var reportedId = $(this).attr("data-val3");
		  	 var reportCode = $(this).attr("data-val4");
			 swal({
						title: "승인 사유입력",
						type: "input",   showCancelButton: true,
						closeOnConfirm: false,
						animation: "slide-from-top",
						inputPlaceholder: "사유 입력",
						confirmButtonColor: '#304ffe',
					}, function(inputValue){
						if (inputValue === false) return false;
						if (inputValue === "") {
							swal({   
								title: "승인 사유를 입력해주세요",
								type: 'error' ,
								confirmButtonColor: '#f60e0e',
							});
							return false
						}
						swal({   
								title: "완료!",
								text: "You wrote: " + inputValue,
								type: 'success' ,
								confirmButtonColor: '#304ffe',
								
						});
						
							
				location.href = "/member/resultReport?reportHistoryCode="+removeCode+"&&reportApproval="+result+"&&reportApprovalReason="+inputValue+"&&reportedId="+reportedId+"&&reportCode="+reportCode
						
			});
		});
		$('.no').click(function(){	
			 var removeCode = $(this).attr("data-val");
		  	 var result = $(this).attr("data-val2");
			 swal({
						title: "반려 사유입력",
						type: "input",   showCancelButton: true,
						closeOnConfirm: false,
						animation: "slide-from-top",
						inputPlaceholder: "사유 입력",
						confirmButtonColor: '#304ffe',
					}, function(inputValue){
						if (inputValue === false) return false;
						if (inputValue === "") {
							swal({   
								title: "반려 사유를 입력해주세요",
								type: 'error' ,
								confirmButtonColor: '#f60e0e',
							});
							return false
						}
						swal({   
								title: "완료!",
								text: "You wrote: " + inputValue,
								type: 'success' ,
								confirmButtonColor: '#304ffe',
								
						});
						
							
				location.href = "/member/resultReport?reportHistoryCode="+removeCode+"&&reportApproval="+result+"&&reportApprovalReason="+inputValue
						
			});
		});
		
		</script>
	</th:block>

</html>