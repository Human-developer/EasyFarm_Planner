<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">

	<th:block layout:fragment="customTitle">
		<title>실행 메인</title>
	</th:block>
	
	<th:block layout:fragment="pageTitle">
		프로젝트별 수입/지출 (결과)
	</th:block>
	
	<!-- 사용자 정의 css 라이브러리 -->
	<th:block layout:fragment="customCssLib">
		
		<!-- Jquery UI -->
		<link rel="stylesheet" th:href="@{/assets/plugin/jquery-ui/jquery-ui.min.css}">
		<link rel="stylesheet" th:href="@{/assets/plugin/jquery-ui/jquery-ui.structure.min.css}">
		<link rel="stylesheet" th:href="@{/assets/plugin/jquery-ui/jquery-ui.theme.min.css}">
		
		<!-- FlexDatalist -->
		<link rel="stylesheet" th:href="@{/assets/plugin/flexdatalist/jquery.flexdatalist.min.css}">
	
		<!-- Popover -->
		<link rel="stylesheet" th:href="@{/assets/plugin/popover/jquery.popSelect.min.css}">
	
		<!-- Select2 -->
		<link rel="stylesheet" th:href="@{/assets/plugin/select2/css/select2.min.css}">
	
		<!-- Timepicker -->
		<link rel="stylesheet" th:href="@{/assets/plugin/timepicker/bootstrap-timepicker.min.css}">
		
		<!-- Colorpicker -->
		<link rel="stylesheet" th:href="@{/assets/plugin/colorpicker/css/bootstrap-colorpicker.min.css}">
	
		<!-- DateRangepicker -->
		<link rel="stylesheet" th:href="@{/assets/plugin/daterangepicker/daterangepicker.css}">
		
		<!-- 데이트피커 플러그인 css, js파일 연결 -->
		<link rel="stylesheet" href="/assets/plugin/air-datepicker/css/datepicker.min.css">
		
		
		
		<!-- Touch Spin -->
		<link rel="stylesheet" href="/assets/plugin/touchspin/jquery.bootstrap-touchspin.min.css">
		
	</th:block>
	
	<!-- 사용자 정의 css -->
	<th:block layout:fragment="customCss">
		
	<style type="text/css">
		.swal2-popup{
	         font-size: medium !important;
	         }
	</style>

	</th:block>
	
	<th:block layout:fragment="customContents">
	
	<div class="row small-spacing">
			<div class="col-xs-12">
				<div class="box-content" style="overflow: auto;">
					<div class="bs-example bs-example-tabs" role="tabpanel" data-example-id="togglable-tabs" style="overflow: auto;">
					
					<a th:href="@{/result}"> :: 결과리스트 :: </a>
					<label for="workPhaseDate" class="col-sm-1 control-label pl-0" style="width: 60px;"><strong>기간</strong></label>
					<div class="col-md-5">
						<div class="input-daterange input-group" id="workPhaseDate-range">
							<input type="text" class="form-control" name="selectedDate" data-language='kr'>
						</div>
					</div>
					
					
					    <ul id="myTab" class="nav nav-tabs" role="tablist">
					      <li role="presentation" class=" active"><a href="#tab1" id="tab1-tab" role="tab" data-toggle="tab" aria-controls="tab1" aria-expanded="false">1111</a></li>
					      <li role="presentation" class=" "><a href="#tab2" id="tab2-tab" role="tab" data-toggle="tab" aria-controls="tab2" aria-expanded="false">22222</a></li>
					      <li role="presentation" class=" "><a href="#tab3" id="tab3-tab" role="tab" data-toggle="tab" aria-controls="tab3" aria-expanded="false">33333</a></li>
					      
					    </ul>
					    <div id="myTabContent" class="tab-content" style="overflow: auto;">
					      <div role="tabpanel" class="tab-pane fade  active in" id="tab1" aria-labelledby="tab1-tab">
					      	
							<div class="box-content card white">
								<div class="box-title">인건비 지출계획</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>근무인원</th>
													<th>근무일수</th>
													<th>일일인건비</th>
													<th>인건비합계</th>
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${#lists.size(workForcePayResult) > 0}" th:each="wf : ${workForcePayResult}">
													<tr>
														<td th:text="${wf.workforcePayPlan.workforceCount}"></td>
														<td th:text="${wf.workforcePayPlan.workforceHowlong}"></td>
														<td th:text="${wf.workforcePayPlan.workforcePayDay}"></td>
														<td th:text="${wf.workforcePayPlan.workforcePayTotal}"></td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>
								<div class="box-title">인건비 실행결과</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>근무인원</th>
													<th>근무일수</th>
													<th>일일인건비</th>
													<th>인건비합계</th>
												</tr>
											</thead>
											<tbody id="workForcePayResult">
												<th:block th:each="wf : ${workForcePayResult}">
													<tr>
														<td>
															<input  th:value="${wf.workforcePayPlan.workforceCount}" class="form-control"/>
														</td>
														<td>
															<input  th:value="${wf.workforcePayPlan.workforceHowlong}" class="form-control"/>
														</td>
														<td>
															<input th:value="${wf.workforcePayPlan.workforcePayDay}" class="form-control"/>
														</td>
														<td>
															<input th:value="${wf.workforcePayPlan.workforcePayTotal}" class="form-control"/>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
										<button id="workforcePayResultSubmit" class ="btn btn-xs btn-success pull-right">결과 작성 마감</button>
									</div>
								</div>
							</div>
							
							<div class="box-content card white">
								<div class="box-title">농기계 대여 지출계획</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>거래처</th>
													<th>농기계종류</th>
													<th>대여일수</th>
													<th>일일대여료</th>
													<th>총대여료합계</th>
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${#lists.size(machineLeasePayResult) > 0}" th:each="ml : ${machineLeasePayResult}">
													<tr>
														<td th:text="${ml.machineLeasePayPlan.clientCode}"></td>
														<td th:text="${ml.machineLeasePayPlan.farmBookmarkMachineCode}"></td>
														<td th:text="${ml.machineLeasePayPlan.machineLeaseHowlong}"></td>
														<td th:text="${ml.machineLeasePayPlan.machineLeasePayDay}"></td>
														<td th:text="${ml.machineLeasePayPlan.machineLeasePayTotal}"></td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>
								<div class="box-title">농기계 대여 실행결과</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>거래처</th>
													<th>농기계종류</th>
													<th>대여일수</th>
													<th>일일대여료</th>
													<th>총대여료합계</th>
												</tr>
											</thead>
											<tbody id="machineLeasePayResult">
												<th:block th:each="ml : ${machineLeasePayResult}">
													<tr>
														<td th:text="${ml.machineLeasePayPlan.clientCode}"></td>
														<td th:text="${ml.machineLeasePayPlan.farmBookmarkMachineCode}"></td>
														<td>
															<input th:value="${ml.machineLeasePayPlan.machineLeaseHowlong}" class="form-control"/>
														</td>
														<td>
															<input th:value="${ml.machineLeasePayPlan.machineLeasePayDay}" class="form-control"/>
														</td>
														<td>
															<input th:value="${ml.machineLeasePayPlan.machineLeasePayTotal}" class="form-control"/>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
										<button id="machineLeasePayResultSubmit" class ="btn btn-xs btn-success pull-right">결과 작성 마감</button>
									</div>
								</div>
							</div>
							
							<div class="box-content card white">
								<div class="box-title">보유 농기계 사용계획</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>농기계종류</th>
													<th>작성자</th>
													<th>작성일</th>
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${#lists.size(machineUsePayResult) > 0}" th:each="mu : ${machineUsePayResult}">
													<tr>
														<td th:text="${mu.machineUsePayPlan.farmRetainMachineCode}"></td>
														<td th:text="${mu.machineUsePayPlan.regMemberId}"></td>
														<td th:text="${mu.machineUsePayPlan.regDate}"></td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>
								<div class="box-title">보유 농기계 사용결과</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>농기계종류</th>
													<th>작성자</th>
													<th>작성일</th>
												</tr>
											</thead>
											<tbody id="machineUsePayResult">
												<th:block th:each="mu : ${machineUsePayResult}">
													<tr>
															<td th:text="${mu.machineUsePayPlan.farmRetainMachineCode}"></td>
														<td>
															<input  th:value="${mu.machineUsePayPlan.regMemberId}" class="form-control"/>
														</td>
														<td>
															<input th:value="${mu.machineUsePayPlan.regDate}" class="form-control"/>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
										<button id="machineUsePayResultSubmit" class ="btn btn-xs btn-success pull-right">결과 작성 마감</button>
									</div>
								</div>
							</div>
							
							<div class="box-content card white">
								<div class="box-title">농자재매입 지출계획</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>품목명</th>
													<th>입고수량</th>
													<th>입고단위</th>
													<th>입고단가</th>
													<th>총구매비</th>
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${#lists.size(resourcePayResult) > 0}" th:each="rp : ${resourcePayResult}">
													<tr>
														<td th:text="${rp.resourcePayPlan.stockItemName}"></td>
														<td th:text="${rp.resourcePayPlan.stockItemIncomeQuantity+'('+rp.resourcePayPlan.stockItemQuantityUnit+')'}"></td>
														<td th:text="${rp.resourcePayPlan.stockItemIncomeQuantityTotal+'('+rp.resourcePayPlan.stockItemQuantityCapacityUnit+')'}"></td>
														<td th:text="${rp.resourcePayPlan.stockItemIncomePerPay}"></td>
														<td th:text="${rp.resourcePayPlan.stockItemTotalPay}"></td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>
								<div class="box-title">농자재매입 매입결과</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>품목명</th>
													<th>입고수량</th>
													<th>입고단위</th>
													<th>입고단가</th>
													<th>총구매비</th>
												</tr>
											</thead>
											<tbody id="resourcePayResult">
												<th:block th:each="rp : ${resourcePayResult}">
													<tr>
														<td th:text="${rp.resourcePayPlan.stockItemName}"></td>
														<td>
															<input  th:value="${rp.resourcePayPlan.stockItemIncomeQuantity}" class="form-control eksdnl" th:data-eksdnl ="${rp.resourcePayPlan.stockItemQuantityUnit}"/>
														</td>
														<td>
															<input th:value="${rp.resourcePayPlan.stockItemIncomeQuantityTotal}" class="form-control eksdnl" th:data-eksdnl ="${rp.resourcePayPlan.stockItemQuantityCapacityUnit}"/>
														</td>
														<td>
															<input th:value="${rp.resourcePayPlan.stockItemIncomePerPay}" class="form-control"/>
														</td>
														<td>
															<input th:value="${rp.resourcePayPlan.stockItemTotalPay}" class="form-control"/>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
										<button id="resourcePayResultSubmit" class ="btn btn-xs btn-success pull-right">결과 작성 마감</button>
									</div>
								</div>
							</div>
							<div class="box-content card white">
								<div class="box-title">공과금 지출계획</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>거래처명</th>
													<th>추가메모</th>
													<th>납부월</th>
													<th>납부금액</th>
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${#lists.size(taxPayResult) > 0}" th:each="tp : ${taxPayResult}">
													<tr>
														<td th:text="${tp.taxPayPlan.clientCode}"></td>
														<td th:text="${tp.taxPayPlan.taxPayDetail}"></td>
														<td th:text="${tp.taxPayPlan.taxPayWhatmonth}"></td>
														<td th:text="${tp.taxPayPlan.taxPay}"></td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>
								<div class="box-title">공과금 지출실행</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>거래처명</th>
													<th>추가메모</th>
													<th>납부월</th>
													<th>납부금액</th>
												</tr>
											</thead>
											<tbody id="taxPayResult">
												<th:block th:each="tp : ${taxPayResult}">
													<tr>
														<td th:text="${tp.taxPayPlan.clientCode}"></td>
														<td th:text="${tp.taxPayPlan.taxPayDetail}"></td>
														<td th:text="${tp.taxPayPlan.taxPayWhatmonth}"></td>
														<td>
															<input th:value="${tp.taxPayPlan.taxPay}" class="form-control"/>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
										<button id="taxPayResultSubmit" class ="btn btn-xs btn-success pull-right">결과 작성 마감</button>
									</div>
								</div>
							</div>
							
							<div class="box-content card white">
								<div class="box-title">기타비용 지출계획</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>거래처명</th>
													<th>지출항목</th>
													<th>지출금액</th>
													<th>지출일자</th>
												</tr>
											</thead>
											<tbody>
												<th:block th:if="${#lists.size(etcpayResult) > 0}" th:each="ep : ${etcpayResult}">
													<tr>
														<td th:text="${ep.etcPayPlan.clientCode}"></td>
														<td th:text="${ep.etcPayPlan.etcPayDetail}"></td>
														<td th:text="${ep.etcPayPlan.etcPay}"></td>
														<td th:text="${ep.etcPayPlan.etcPayDate}"></td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>
								
								<div class="box-title">기타비용 지출실행</div>
								<div class="card-content">
									<div class="table-responsive">
										<table class="table table-hover" style="width:100%">
											<thead>
												<tr>
													<th>거래처명</th>
													<th>지출항목</th>
													<th>지출금액</th>
													<th>지출일자</th>
												</tr>
											</thead>
											<tbody id="etcPayResult">
												<th:block th:each="ep : ${etcpayResult}">
													<tr>
														<td th:text="${ep.etcPayPlan.clientCode}"></td>
														<td th:text="${ep.etcPayPlan.etcPayDetail}"></td>
														<td>
															<input th:value="${ep.etcPayPlan.etcPay}" class="form-control"/>
														</td>
														<td>
															<input th:value="${ep.etcPayPlan.etcPayDate}" class="form-control"/>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
										<button id="etcPayResultSubmit" class ="btn btn-xs btn-success pull-right">결과 작성 마감</button>
									</div>
								</div>
							</div>
								<button id="resultSubmitBtn" class="btn btn-danger form-control">결과 제출</button>
						</div>
					      <div role="tabpanel" class="tab-pane fade " id="tab2" aria-labelledby="tab2-tab">
								asd
					      </div>
					      <div role="tabpanel" class="tab-pane fade " id="tab3" aria-labelledby="tab3-tab">
								[[${planWorkphaseCate[0].planWorkphaseCateBegin}]]
								[[${planWorkphaseCate[1].planWorkphaseCateBegin}]]
					      </div>
						</div>
					</div>
				</div>	
			</div>
			</div>
	
	</th:block>	
	
	
	
	
		
	</th:block>
	
	<!-- 사용자 정의 자바스크립트 라이브러리 -->
	<th:block layout:fragment="customScriptLib">
		<script src="/assets/plugin/datatables/media/js/jquery.dataTables.min.js"></script>
		<script src="/assets/plugin/datatables/media/js/dataTables.bootstrap.min.js"></script>
		<script src="/assets/plugin/datatables/extensions/Responsive/js/dataTables.responsive.min.js"></script>
		<script src="/assets/plugin/datatables/extensions/Responsive/js/responsive.bootstrap.min.js"></script>
		<script src="/assets/scripts/datatables.demo.min.js"></script>
		<script src="/assets/plugin/air-datepicker/js/datepicker.min.js"></script>
		<!-- Moment -->
		<script th:src="@{/assets/plugin/moment/moment.js}"></script>
		<script src="/assets/plugin/air-datepicker/js/i18n/datepicker.kr.js"></script>
		<script th:src="@{/assets/plugin/daterangepicker/daterangepicker.js}"></script>
			
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>	
		<script th:src="@{/assets/plugin/touchspin/jquery.bootstrap-touchspin.min.js}"></script>
	</th:block>
	
	
	<!-- 사용자 정의 자바스크립트 -->
	<th:block layout:fragment="customJavaScript">
		
		<script type="text/javascript">
			function moveAddSpend(btn){
				location.href = $(btn).attr('data-value');
			};
			
			/* datepicker */
			var date = new Date();
			$('[name="selectedDate"]').val("날짜를 선택해 주세요");
			var beginDate = $('[name="selectedDate"]').datepicker({
			  //년-월-일
			
			  startDate: new Date(date.getFullYear(), date.getMonth(), date.getDate()),
			  language: 'kr',
			  autoClose: true,
			  //선택한 날짜를 가져옴
			  
			  onSelect: function (date) {
			      //시작일 datepicker에 최대날짜를 방금 클릭한 날짜로 설정
			      var selectedDate = $('[name="selectedDate"]').val();
			      console.log(selectedDate + "<<<selectedDate");
			      
			      var request = $.ajax({
		               url:"/result/getPlanDataforResult",
		               method:"post", 
		               data : {
		            	   	"selectedDate":selectedDate,
		            	   	"planWorkphaseCate":"[[${planWorkphaseCate}]]"
		            	   	},
		               datatype: "json",
		            });
		            request.done(function(data)
		            {
		            	for(var i=0; i < data.length; i++)
		            	{
		            		var code =  data[i].projectCode;
		            		var value = data[i].projectName;
		            		Project[code] = value;
		            	}
		            });
		            request.fail(function( jqXHR, textStatus )
		            {
		               alert( "Request failed : " + textStatus );
		            });
			  }
			}).data('datepicker');
			
			/* datepicker */
			var date = new Date();
			var beginDate = $('[name="planWorkphaseCateBegin"]').datepicker({
			  //년-월-일
			  startDate: new Date(date.getFullYear(), date.getMonth(), date.getDate()),
			  language: 'kr',
			  autoClose: true,
			  //선택한 날짜를 가져옴
			  onSelect: function (date) {
			      //시작일 datepicker에 최대날짜를 방금 클릭한 날짜로 설정
			      var endNum 	= new Date(date);
			      var endDate 	= $('[name="planWorkphaseCateEnd"]');
			      
			      endDate.datepicker({
			          minDate: new Date(endNum)
			      });
			      if(endDate.val() == ""){
			    	  endDate.val(date);
			      }
			      
			  }
			}).data('datepicker');
			var endDate = $('[name="planWorkphaseCateEnd"]').datepicker({
			  startDate: new Date(date.getFullYear(), date.getMonth(), date.getDate()),  // 시간, 분은 00으로 초기 설정
			  language: 'kr',
			  autoClose: true,
			  //선택한 날짜를 가져옴
			  onSelect: function (date) {
				  
			      var startNum 	= new Date(date);
			      var startDate = $('[name="planWorkphaseCateBegin"]');
			      
			      startDate.datepicker({
			          //시작일 datepicker에 최대날짜를 방금 클릭한 날짜로 설정
			          maxDate: new Date(startNum)
			      });
			      
			      if(startDate.val() == ""){
			    	  startDate.val(date);
			      }
			      
			  }
			}).data('datepicker');
			
	
	 	$('.btn-xs').click(function(){
	 		var tableId = $(this).parent().find('tbody').attr('id')
	 		if($(this).text() == '결과 작성 마감'){
		 		$(this).parent().find('input').attr('readonly','readonly');
		 		$(this).text('취소').removeClass('btn-success').addClass('btn-danger');
		 		console.log(tableId);
		 		console.log($(this).parent().find('input').eq(0).val());
	 		}
	 		else{
	 			$(this).parent().find('input').removeAttr('readonly');
	 			$(this).text('결과 작성 마감').removeClass('btn-danger').addClass('btn-success');
	 		}
	 	})
	 	
	 	 $(".eksdnl").each(function(){
	 		var eksdnl = $(this).attr('data-eksdnl');
	 		$(this).TouchSpin({
		         verticalbuttons: true,
		         min : 0,
		         max : 10000000000,
		         postfix : eksdnl
		      }); 
	 		$(this).parent().find('.input-group-btn-vertical').remove();
	 	 })
		
	 	 $('#resultSubmitBtn').click(function(){
	 		Swal.fire({
	 			  title: '결과를 저장하시겠습니까?',
	 			  showCancelButton: true,
	 			  confirmButtonText: '저장하기',
	 			  cancelButtonText: '취소',
	 			}).then((result) => {
	 			  /* Read more about isConfirmed, isDenied below */
	 			  if (result.isConfirmed) {
	 			    Swal.fire('Saved!', '', 'success').then(() =>{
	 			    	location.href="/result"
	 			    })
	 			  } else if (result.isDenied) {
	 			    Swal.fire('Changes are not saved', '', 'info')
	 			  }
	 			})
	 	 })
	 	 $('.mdi-logout').click(function(){
	 		Swal.fire({
	 			  title: '로그아웃 하시겠습니까?',
	 			  showCancelButton: true,
	 			  confirmButtonText: '로그아웃',
	 			  cancelButtonText: '취소',
	 			}).then((result) => {
	 			  /* Read more about isConfirmed, isDenied below */
	 			  if (result.isConfirmed) {
	 			    Swal.fire('로그아웃 성공!', '', 'success').then(() =>{
	 			    	location.href="/member/logout"
	 			    })
	 			  } else if (result.isDenied) {
	 			    Swal.fire('Changes are not saved', '', 'info')
	 			  }
	 			})
	 	 })
	 </script>
	
	
</html>